import{a as T,u as G,r as t,j as e,c as f,s as y,e as w,g as v,p as r,h as k}from"./index-CZ8Xrph2.js";import{M as V}from"./bootstrap.esm-CPbp9n-C.js";import{D as F}from"./DeleteModal-TxstVEoO.js";function J(){var M,C,$,q,D;const p="https://ec-course-api.hexschool.io",b="imsmallnew",l=T(),{cartList:n}=G(s=>s.cart),H={title:"",category:"",unit:"",origin_price:"",price:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[]},[U]=t.useState(H),[z,A]=t.useState({}),[h]=t.useState(!1),[_]=t.useState("cart"),j=t.useRef(null),x=t.useRef(null);t.useEffect(()=>{j.current&&(x.current=new V(j.current,{backdrop:!1}))},[]);const g=s=>{A(s),x.current?x.current.show():console.error("Modal instance is not initialized.")},N=()=>{x.current?x.current.hide():console.error("Modal instance is not initialized.")};window.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()});const u=async(s,i)=>{var d,a,o,E,R,S,m;l(y("更新購物車中..."));try{const c=await w.put(`${p}/v2/api/${b}/cart/${s==null?void 0:s.id}`,{data:{product_id:(d=s==null?void 0:s.product)==null?void 0:d.id,qty:Number(i)}});l(v()),l(r({title:"更新成功",text:`[${(a=s==null?void 0:s.product)==null?void 0:a.title}] 數量已更新為 ${(E=(o=c.data)==null?void 0:o.data)==null?void 0:E.qty} ${(R=s==null?void 0:s.product)==null?void 0:R.unit}`,status:"success"}))}catch(c){console.error(c),l(r({title:"系統提示",text:((m=(S=c==null?void 0:c.response)==null?void 0:S.data)==null?void 0:m.message)||"購物車更新數量失敗",status:"failed"}))}finally{l(k())}},B=async s=>{var i,d,a;l(y("移除購物車商品中..."));try{await w.delete(`${p}/v2/api/${b}/cart/${s.id}`),N(),l(v()),l(r({title:"刪除成功",text:`[${(i=s==null?void 0:s.product)==null?void 0:i.title}] 已從購物車移除`,status:"success"}))}catch(o){console.error(o),l(r({title:"系統提示",text:((a=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:a.message)||"刪除購物車商品失敗",status:"failed"}))}finally{l(k())}},P=async()=>{var s,i;l(y("清空購物車商品中..."));try{await w.delete(`${p}/v2/api/${b}/carts`),N(),l(v()),l(r({title:"系統提示",text:"購物車已清空",status:"success"}))}catch(d){console.error(d),l(r({title:"系統提示",text:((i=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:i.message)||"清空購物車商品失敗",status:"failed"}))}finally{l(k())}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container-fluid",style:{backgroundImage:"url('https://images.unsplash.com/photo-1491960693564-421771d727d6?q=80&w=2863&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D')",backgroundSize:"cover",backgroundPosition:"center",minHeight:"100vh",paddingTop:"60px",position:"relative",paddingBottom:"40px"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.3)",zIndex:1}}),e.jsx("div",{className:"container position-relative pb-3 bg-white rounded-3 mt-5",style:{zIndex:2},children:e.jsxs("div",{className:"mt-4",children:[((M=n==null?void 0:n.carts)==null?void 0:M.length)===0&&e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"badge p-2 pe-3 ps-3 text-dark fs-6 mt-2 lh-base w-100",children:["[溫馨提示]: 購物車目前為空！",e.jsx("br",{className:"mobileValue"}),"請至 ",e.jsx(f,{className:"text-dark text-decoration-none",to:"/products",children:e.jsx("span",{className:"badge bg-danger",children:"商品列表"})})," 挑選你想吃的唷 ( *´ސު｀*)"]})}),e.jsx("div",{className:"table-responsive d-none d-md-block",children:e.jsxs("table",{className:"table mt-3 table-hover text-dark bg-light overflow-hidden",children:[e.jsx("thead",{className:"table-warning text-dark",children:e.jsxs("tr",{className:"text-center",children:[e.jsx("th",{style:{width:"120px"},children:"圖片"}),e.jsx("th",{children:"商品名稱"}),e.jsx("th",{children:"分類"}),e.jsx("th",{style:{width:"150px"},children:"訂購數量"}),e.jsx("th",{children:"單價"}),e.jsx("th",{children:"小計"}),e.jsx("th",{style:{width:"180px"}})]})}),e.jsx("tbody",{children:(C=n==null?void 0:n.carts)==null?void 0:C.map(s=>{var i,d,a,o;return e.jsxs("tr",{className:"align-middle text-center",children:[e.jsx("td",{className:"text-start",children:e.jsx("img",{src:(i=s==null?void 0:s.product)==null?void 0:i.imageUrl,className:"rounded border border-gold",alt:"主圖",width:"100"})}),e.jsx("td",{className:"text-center",children:e.jsx("h5",{children:(d=s==null?void 0:s.product)==null?void 0:d.title})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-danger",children:(a=s==null?void 0:s.product)==null?void 0:a.category})}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{type:"button",disabled:(s==null?void 0:s.qty)===1||h,className:"btn btn-outline-dark btn-sm",onClick:()=>u(s,(s==null?void 0:s.qty)-1),children:"−"}),e.jsx("span",{className:"btn border border-secondary bg-white text-dark",style:{width:"50px",cursor:"auto"},children:s.qty}),e.jsx("button",{type:"button",disabled:h,className:"btn btn-outline-dark btn-sm",onClick:()=>u(s,(s==null?void 0:s.qty)+1),children:"+"})]})}),e.jsxs("td",{className:"text-dark fw-bold",children:[(o=s==null?void 0:s.product)==null?void 0:o.price," 元"]}),e.jsxs("td",{className:"text-dark fw-bold",children:[s==null?void 0:s.total," 元"]}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>g(s),children:e.jsx("i",{className:"fas fa-trash-alt"})})})]},s==null?void 0:s.id)})})]})}),e.jsx("div",{className:"d-md-none pt-3",children:($=n==null?void 0:n.carts)==null?void 0:$.map(s=>{var i,d,a,o;return e.jsx("div",{className:"card mb-3 shadow-sm",children:e.jsxs("div",{className:"row g-0 align-items-center",children:[e.jsx("div",{className:"col-6 p-2",children:e.jsx("img",{src:(i=s==null?void 0:s.product)==null?void 0:i.imageUrl,className:"img-fluid rounded border border-gold",alt:"主圖"})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"card-body p-2",children:[e.jsx("h6",{className:"card-title",children:(d=s==null?void 0:s.product)==null?void 0:d.title}),e.jsx("p",{className:"mb-1",children:e.jsx("span",{className:"badge bg-danger",children:(a=s==null?void 0:s.product)==null?void 0:a.category})}),e.jsxs("p",{className:"mb-1 text-dark fw-bold",children:["單價：",(o=s==null?void 0:s.product)==null?void 0:o.price," 元"]}),e.jsxs("p",{className:"mb-1 text-dark fw-bold",children:["小計：",s==null?void 0:s.total," 元"]}),e.jsxs("div",{className:"btn-group btn-group-sm mt-1",role:"group",children:[e.jsx("button",{type:"button",disabled:(s==null?void 0:s.qty)===1||h,className:"btn btn-outline-dark",onClick:()=>u(s,(s==null?void 0:s.qty)-1),children:"−"}),e.jsx("span",{className:"btn border border-secondary bg-white text-dark",style:{width:"40px",cursor:"auto"},children:s.qty}),e.jsx("button",{type:"button",disabled:h,className:"btn btn-outline-dark",onClick:()=>u(s,(s==null?void 0:s.qty)+1),children:"+"})]}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm mt-1 ms-2",onClick:()=>g(s),children:e.jsx("i",{className:"fas fa-trash-alt"})})]})})]})},s==null?void 0:s.id)})}),e.jsxs("div",{className:"text-end bg-white rounded-3 p-3 d-none",children:[e.jsxs("h5",{className:"text-dark",children:["總計：",e.jsxs("span",{className:"text-danger fw-bold",children:[n==null?void 0:n.total," 元"]})]}),e.jsxs("h5",{className:"text-dark",children:["折扣價：",e.jsxs("span",{className:"text-success fw-bold",children:[n==null?void 0:n.final_total," 元"]})]})]}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row g-2 mt-2 justify-content-end text-center text-md-end",children:[((q=n==null?void 0:n.carts)==null?void 0:q.length)!==0&&e.jsx("div",{className:"col-md-3",children:e.jsx("button",{className:"btn btn-outline-danger w-100 px-4 py-2",type:"button",onClick:()=>g({}),children:e.jsx("span",{children:"清空購物車"})})}),e.jsx("div",{className:"col-md-3",children:e.jsx(f,{className:"btn btn-dark btn-hover w-100 px-4 py-2",to:"/products",children:e.jsx("span",{children:"繼續購物"})})}),((D=n==null?void 0:n.carts)==null?void 0:D.length)!==0&&e.jsx("div",{className:"col-md-3",children:e.jsx(f,{className:"btn btn-dark btn-hover w-100 px-4 py-2",to:"/form",children:e.jsx("span",{children:"結帳表單"})})})]})})]})})]}),e.jsx(F,{deleteModalRef:j,tempProduct:U,navigation:_,cartItem:z,removeCartItem:B,removeAllCart:P,closeDeleteModal:N})]})}export{J as default};
