import{j as e,P as s,f as ue,c as be,a as je,r as u,d as v,s as w,p,h as $}from"./index-BHl6oezR.js";import{M as J}from"./bootstrap.esm-CPbp9n-C.js";import{P as pe}from"./Pagination-Dn_cP0zo.js";import{D as fe}from"./DeleteModal-BmoaQwfJ.js";function K({state:r,productList:m=[],tempProduct:t,openProductModal:f,openDeleteModal:c,handleChangeOption:b,setTempProduct:k,setTempImgUrl:C,setState:N}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-6 mt-2",children:e.jsx("kbd",{children:"商品列表"})}),e.jsx("div",{className:"col-6",children:e.jsx("button",{className:"btn btn-outline-success me-2  float-end",type:"button",id:"checkBtn",disabled:r,onClick:()=>{f("create"),N(!0)},children:"新增商品"})})]}),e.jsxs("table",{className:"table mt-3 table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"table-info border-2",children:[e.jsx("th",{scope:"col",children:"商品名稱"}),e.jsx("th",{scope:"col",className:"text-center",children:"分類"}),e.jsx("th",{scope:"col",className:"text-center",children:"原價"}),e.jsx("th",{scope:"col",className:"text-center",children:"售價"}),e.jsx("th",{scope:"col",className:"text-center",children:"是否啟用"}),e.jsx("th",{scope:"col",className:"text-center"})]})}),e.jsx("tbody",{className:"align-middle",children:m==null?void 0:m.map(h=>e.jsxs("tr",{children:[e.jsx("td",{children:h.title}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:"badge bg-danger",children:h.category})}),e.jsx("td",{className:"text-center text-primary",children:h.origin_price}),e.jsx("td",{className:"text-center text-primary",children:h.price}),e.jsxs("td",{className:`text-center ${h.is_enabled===1?"text-dark":"text-danger"}`,children:[h.is_enabled===1?"已啟用":"已停用",e.jsx("span",{children:" "}),e.jsxs("select",{value:h.is_enabled===1?"Y":"N",onChange:_=>b(_,h),children:[e.jsx("option",{value:"Y",children:"Y"}),e.jsx("option",{value:"N",children:"N"})]})]}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"btn-group float-end",children:[e.jsxs("button",{type:"button",className:`btn ${(h==null?void 0:h.id)===(t==null?void 0:t.id)?"btn-secondary btn-sm":"btn-outline-secondary btn-sm"}`,onClick:()=>{k(h),C(h.imageUrl)},children:["檢視商品 ",e.jsx("i",{className:"fas fa-search"})]}),e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{f("edit",h),N(!0)},children:["編輯 ",e.jsx("i",{className:"fas fa-edit"})]}),e.jsxs("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>c(h),children:["刪除 ",e.jsx("i",{className:"fas fa-trash"})]})]})})]},h.id))})]})]})}K.propTypes={state:s.bool,productList:s.arrayOf(s.shape({id:s.oneOfType([s.string,s.number]),title:s.string,category:s.string,origin_price:s.number,price:s.number,is_enabled:s.number,imageUrl:s.string})),tempProduct:s.shape({id:s.oneOfType([s.string,s.number])}),openProductModal:s.func,openDeleteModal:s.func,handleChangeOption:s.func,setTempProduct:s.func,setTempImgUrl:s.func,setState:s.func};function Q({tempProduct:r,tempImgUrl:m,setTempImgUrl:t}){var f;return e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"商品內容"}),r.title?e.jsx("div",{className:"card mt-4",children:e.jsxs("div",{className:"row",children:[m?e.jsx("div",{className:"col-md-12",children:e.jsx("div",{className:"mainWrap",children:e.jsx("img",{src:m,className:"object-fit-cover img-fluid w-100 h-100 p-3",alt:"主圖"})})}):e.jsxs("h6",{className:"text-danger",children:[e.jsx("i",{className:"fa-regular fa-image"})," 主圖 尚未提供連結"]}),e.jsx("div",{className:"col-md-12",children:e.jsxs("div",{className:"card-body pl-3 pr-3",children:[e.jsx("h2",{className:"card-title",children:r.title}),e.jsx("h5",{children:e.jsx("span",{className:"badge bg-danger",children:r.category})}),e.jsxs("p",{className:"card-text",children:["商品描述: ",e.jsx("small",{className:"text-muted",children:r.description})]}),e.jsxs("p",{className:"card-text",children:["商品內容: ",e.jsx("small",{className:"text-muted",children:r.content})]}),e.jsxs("div",{className:"d-flex",children:[e.jsxs("h4",{className:"card-text text-danger fw-bold",children:[r.price," 元  / "]}),e.jsx("h4",{className:"card-text text-secondary",children:e.jsxs("del",{children:[r.origin_price," 元"]})})]}),e.jsx("p",{className:"mt-3",children:"更多圖片(點圖放大):"}),e.jsxs("div",{className:"row",children:[r.imageUrl&&e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx("div",{className:"subWrap",children:e.jsx("div",{className:"imgFrame",children:e.jsx("img",{src:r.imageUrl,className:"card-img w-100 h-100 text-start object-fit-cover",alt:"副圖",onClick:()=>{t(r.imageUrl)}})})})}),(f=r==null?void 0:r.imagesUrl)==null?void 0:f.map((c,b)=>c?e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx("div",{className:"subWrap",children:e.jsx("div",{className:"imgFrame",children:e.jsx("img",{src:c,className:"card-img w-100 h-100 text-start object-fit-cover",alt:"副圖",onClick:()=>{t(c)}})})})},b):null)]})]})})]})}):e.jsx("div",{className:"text-muted mt-3",children:"請點選按鈕查看內容"})]})}Q.propTypes={tempProduct:s.shape({title:s.string,category:s.string,origin_price:s.number,price:s.number,description:s.string,content:s.string,is_enabled:s.number,imageUrl:s.string,imagesUrl:s.arrayOf(s.string)}),tempImgUrl:s.string,setTempImgUrl:s.func.isRequired};function X({productModalRef:r,target:m,tempProduct:t,categories:f,units:c,handleInputChange:b,handleFileChange:k,handleImageChange:C,imagesUrlRemove:N,badgeReplace:h,imagesUrlAdd:_,closeProductModal:T,handleModalUpdate:o}){var j,I,S,O,D;return e.jsx("div",{id:"productModal",ref:r,className:"modal",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{maxWidth:"980px"},children:e.jsxs("div",{className:"modal-content border-0 shadow",children:[e.jsxs("div",{className:`modal-header border-bottom ${m==="create"?"bg-success":"bg-primary"}`,children:[e.jsx("h5",{className:"modal-title fs-4 text-white",children:m==="create"?"新增商品":"編輯商品"}),e.jsx("button",{type:"button",className:"btn-close bg-white","aria-label":"Close",onClick:()=>T()})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-md-10",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"title",className:"form-label",children:"商品名稱"}),e.jsx("input",{name:"title",id:"title",type:"text",className:"form-control",placeholder:"請輸入商品名稱",onChange:b,value:t.title})]})}),e.jsxs("div",{className:"col-12 col-md-6 pb-4",children:[e.jsx("label",{className:"form-check-label",htmlFor:"isEnabled",children:"是否啟用"}),e.jsx("div",{className:"form-check ms-2",children:e.jsx("input",{name:"is_enabled",type:"checkbox",className:`form-check-input ${m==="create"&&t.is_enabled===1?"bg-success":""}`,id:"isEnabled",onChange:b,checked:t.is_enabled===1})})]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"分類"}),e.jsx("input",{name:"category",id:"category",type:"text",className:"form-control",placeholder:"請輸入分類",onChange:b,value:t.category}),e.jsx("div",{className:"mt-2",children:f.map(x=>e.jsx("label",{className:"badge bg-danger m-1",htmlFor:"category",onClick:d=>h(d),children:x},x))})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"unit",className:"form-label",children:"單位"}),e.jsx("input",{name:"unit",id:"unit",type:"text",className:"form-control",placeholder:"請輸入單位",onChange:b,value:t.unit}),e.jsx("div",{className:"mt-2",children:c.map(x=>e.jsx("label",{className:"badge bg-danger m-1",htmlFor:"unit",onClick:d=>h(d),children:x},x))})]})})]}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"origin_price",className:"form-label",children:"原價"}),e.jsx("input",{name:"origin_price",id:"origin_price",type:"number",className:"form-control",placeholder:"請輸入原價",onChange:x=>{Number(x.target.value)>=0?b(x):(alert("原價不能小於 0"),x.target.value=0)},value:t.origin_price,min:"0"})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"售價"}),e.jsx("input",{name:"price",id:"price",type:"number",className:"form-control",placeholder:"請輸入售價",onChange:x=>{Number(x.target.value)>=0?b(x):(alert("售價不能小於 0"),x.target.value=0)},value:t.price,min:"0"})]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"商品描述"}),e.jsx("textarea",{name:"description",id:"description",className:"form-control",rows:4,placeholder:"請輸入商品描述",onChange:b,value:t.description})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"說明內容"}),e.jsx("textarea",{name:"content",id:"content",className:"form-control",rows:4,placeholder:"請輸入說明內容",onChange:b,value:t.content})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("ul",{className:"list-group",children:[e.jsx("li",{className:`list-group-item active ${m==="create"?"bg-success":""}`,"aria-current":"true",children:e.jsxs("div",{className:"row",children:[e.jsx("label",{htmlFor:"primary-image",className:"col-sm-1 col-form-label",children:"主圖"}),e.jsx("div",{className:"col-sm-11",children:e.jsxs("div",{className:"column",children:[e.jsx("input",{type:"file",accept:".jpg,.jpeg,.png",className:"form-control",id:"fileInput",name:"file-to-upload",onChange:x=>k(x)}),e.jsx("input",{name:"imageUrl",type:"text",id:"primary-image",className:"form-control mt-2",placeholder:"請輸入主圖連結",onChange:b,value:t.imageUrl})]})})]})},"imageUrl"),(j=t==null?void 0:t.imagesUrl)==null?void 0:j.map((x,d)=>e.jsx("li",{className:`list-group-item mt-1 ${m==="create"?"bg-success bg-opacity-25":"bg-primary bg-opacity-25"}`,children:e.jsxs("div",{className:"row",children:[e.jsxs("label",{htmlFor:`imagesUrl-${d+1}`,className:"col-sm-1 col-form-label",children:["副圖",d+1]}),e.jsx("div",{className:"col-sm-10",children:e.jsx("input",{id:`imagesUrl-${d+1}`,type:"text",placeholder:`請輸入副圖${d+1}連結`,className:"form-control",onChange:E=>C(E,d),value:t.imagesUrl[d]})}),e.jsxs("button",{type:"button",className:"btn btn-danger btn-sm col-sm-1",onClick:()=>N(d),children:["刪除 ",e.jsx("i",{className:"fas fa-trash"})]})]})},`imagesUrl_${d+1}_${x}`))]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("button",{type:"button",className:`btn btn-lg ${m==="create"?"btn-outline-success":"btn-outline-primary"}`,disabled:((I=t==null?void 0:t.imagesUrl)==null?void 0:I.length)===5,onClick:_,children:[((S=t==null?void 0:t.imagesUrl)==null?void 0:S.length)===5?"已達上限無法新增副圖":"新增副圖"," (",(O=t==null?void 0:t.imagesUrl)==null?void 0:O.length,"/5) ",e.jsx("i",{className:"fa-regular fa-image"})]})})]})]}),e.jsxs("div",{className:"col-md-2 modalImgWrap",children:[e.jsx("div",{className:"mb-2",children:t.imageUrl?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"primary-image",className:"form-label border border-2 border-dashed rounded-3 ps-1 pe-1 m-1 bg-dark bg-opacity-50 text-white",children:"主圖"}),e.jsx("img",{src:t.imageUrl,alt:t.title,className:"img-fluid"})]}):e.jsx(e.Fragment,{children:e.jsxs("h6",{className:"text-danger",children:[e.jsx("i",{className:"fa-regular fa-image"})," 主圖 尚未提供連結"]})})}),(D=t==null?void 0:t.imagesUrl)==null?void 0:D.map((x,d)=>e.jsx("div",{className:"modalImgWrap",children:x?e.jsxs(e.Fragment,{children:[e.jsxs("label",{htmlFor:`imagesUrl-${d+1}`,className:"form-label border border-2 border-dashed rounded-3 ps-1 pe-1 m-1 bg-dark bg-opacity-50 text-white",children:["副圖 ",d+1]}),e.jsx("img",{src:x,alt:`副圖 ${d+1}`,className:"img-fluid mb-2"})]}):e.jsxs("h6",{className:"text-danger",children:[e.jsx("i",{className:"fa-regular fa-image"})," 副圖",d+1,"尚未提供連結"]})},`image-wrap-${d}`))]})]})}),e.jsxs("div",{className:"modal-footer border-top bg-light",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>T(),children:"取消"}),e.jsx("button",{type:"button",className:`btn ${m==="create"?"btn-success ":"btn-primary"}`,onClick:()=>o(t),children:"確認"})]})]})})})}X.propTypes={productModalRef:s.shape({current:s.any}),target:s.oneOf(["create","edit"]),tempProduct:s.shape({title:s.string,category:s.string,unit:s.string,origin_price:s.number,price:s.number,description:s.string,content:s.string,is_enabled:s.oneOfType([s.number,s.bool]),imageUrl:s.string,imagesUrl:s.arrayOf(s.string)}).isRequired,categories:s.arrayOf(s.string).isRequired,units:s.arrayOf(s.string).isRequired,handleInputChange:s.func,handleFileChange:s.func,handleImageChange:s.func,imagesUrlRemove:s.func,badgeReplace:s.func,imagesUrlAdd:s.func,closeProductModal:s.func,handleModalUpdate:s.func};function we(){const r="https://ec-course-api.hexschool.io",m="imsmallnew",{page:t}=ue(),f=be(),c=je(),b={title:"",category:"",unit:"",origin_price:0,price:0,description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[]},[k,C]=u.useState({}),[N,h]=u.useState(Number(t)),[_,T]=u.useState([]),[o,j]=u.useState(b),[I,S]=u.useState([]),[O,D]=u.useState([]),[x,d]=u.useState(null),[E,L]=u.useState(!1),[A,Z]=u.useState(null),[H]=u.useState("admin"),[P,ee]=u.useState({}),W=u.useRef(null),F=u.useRef(null),z=u.useRef(null),M=u.useRef(null),B=u.useCallback(async()=>{try{await v.get(`${r}/v2/api/${m}/products/all`).then(a=>{let l=a.data.products,i=[...new Set(l.map(g=>g.category))],n=[...new Set(l.map(g=>g.unit))];S(i),D(n)})}catch(a){console.error(a)}},[r,m]),U=u.useCallback(async a=>{var l,i;c(w("讀取中..."));try{await v.get(`${r}/v2/api/${m}/admin/products?page=${a}`).then(n=>{let g=n.data.products;T(g),B(),(g==null?void 0:g.length)>0&&j(g[0]),(g==null?void 0:g.length)>0&&d(g[0].imageUrl),C(n.data.pagination)})}catch(n){console.error(n),c(p({title:"系統提示",text:((i=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:i.message)||"取得商品資料失敗",status:"failed"}))}finally{c($())}},[r,m,c,B]),V=u.useCallback(async()=>{var a,l;c(w("讀取中..."));try{await v.post(`${r}/v2/api/user/check`)}catch(i){c(p({title:"系統提示",text:((l=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:l.message)||"驗證登入失敗",status:"failed"})),f("/login")}finally{c($())}},[r,c,f]);u.useEffect(()=>{const a=document.cookie.replace(/(?:(?:^|.*;\s*)reactHWToken\s*=\s*([^;]*).*$)|^.*$/,"$1");a.length>0?(v.defaults.headers.common.Authorization=a,V()):f("/login")},[V,f]),u.useEffect(()=>{U(N)},[N,U]),u.useEffect(()=>{Number(t)!==N&&h(Number(t))},[t,h,N]);const se=a=>{h(a),f(`/admin/products/${a}`,{replace:!0})},ae=async()=>{var a,l,i;c(w("新增商品資料中..."));try{await v.post(`${r}/v2/api/${m}/admin/product`,{data:{...o,origin_price:Number(o.origin_price),price:Number(o.price),imagesUrl:((a=o.imagesUrl)==null?void 0:a.length)===0?[""]:o.imagesUrl}}),c(p({title:"新增商品成功",text:"商品名稱:"+o.title,status:"success"})),U(),q()}catch(n){console.error(n),c(p({title:"系統提示",text:((i=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:i.message)||"新增商品失敗",status:"failed"}))}finally{c($())}},G=async a=>{var i,n,g;const l=document.getElementById("productModal");c(w("更新商品資料中..."));try{await v.put(`${r}/v2/api/${m}/admin/product/${a.id}`,{data:{...a,origin_price:Number(a.origin_price),price:Number(a.price),imagesUrl:((i=a.imagesUrl)==null?void 0:i.length)===0?[""]:a.imagesUrl}}),l!=null&&l.classList.contains("show")&&c(p({title:"更新商品成功",text:"商品名稱:"+o.title,status:"success"})),U(),q()}catch(y){console.error(y),l!=null&&l.classList.contains("show")&&c(p({title:"系統提示",text:((g=(n=y==null?void 0:y.response)==null?void 0:n.data)==null?void 0:g.message)||"更新商品失敗",status:"failed"}))}finally{c($())}},le=async()=>{var a,l;c(w("刪除商品資料中..."));try{await v.delete(`${r}/v2/api/${m}/admin/product/${o.id}`),c(p({title:"刪除商品成功",text:"商品名稱:"+o.title,status:"success"})),U(),j(b),Y()}catch(i){Y(),console.error(i),c(p({title:"系統提示",text:((l=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:l.message)||"刪除商品失敗",status:"failed"}))}finally{c($())}},te=a=>{const{name:l,value:i,checked:n,type:g}=a.target;j({...o,[l]:g==="checkbox"?n?1:0:i||""})},ce=async a=>{var l,i;try{A==="create"?await ae():await G(a)}catch(n){let g=A==="create"?"新增":"更新";c(p({title:"系統提示",text:((i=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:i.message)||`${g}商品失敗`,status:"failed"})),alert(`更新商品失敗！

`+(n==null?void 0:n.response.data.message.join(`
`)))}},ie=(a,l)=>{const{value:i}=a.target,n=[...o.imagesUrl];n[l]=i,j({...o,imagesUrl:n})},ne=a=>{const{innerText:l,htmlFor:i}=a.target;j({...o,[i]:l})},re=async(a,l)=>{var g,y;const i=a.target.value==="Y"?1:0,n={...l,is_enabled:i};try{await G(n),U();const R=n.is_enabled===1?"已啟用":"已停用";c(p({title:"系統提示",text:`[商品]${n.title}: ${R}`,status:"success"}))}catch(R){c(p({title:"系統提示",text:((y=(g=R==null?void 0:R.response)==null?void 0:g.data)==null?void 0:y.message)||`[商品]${n.title}: 更新啟用狀態失敗`,status:"failed"}))}},oe=()=>{const a=[...o.imagesUrl];a.push(""),j({...o,imagesUrl:a})},de=a=>{const l=[...o.imagesUrl];l.splice(a,1),j({...o,imagesUrl:l})},me=a=>{const l=a.target.files[0],i=new FormData;l?(i.append("file-to-upload",l),he(i)):c(p({title:"系統提示",text:"尚未取得圖片資料來源, 無法上傳!",status:"failed"}))},he=async a=>{c(w("上傳圖片中..."));try{const i=(await v.post(`${r}/v2/api/${m}/admin/upload`,a)).data.imageUrl;c(p({title:"系統提示",text:"圖片上傳成功",status:"success"})),i&&j({...o,imageUrl:i})}catch(l){console.error(l),c(p({title:"系統提示",text:"上傳圖片失敗",status:"failed"}))}finally{c($())}};u.useEffect(()=>{W.current&&(F.current=new J(W.current,{backdrop:!1})),z.current&&(M.current=new J(z.current,{backdrop:!1}))},[]);const ge=(a,l)=>{Z(a),j(a==="edit"?l:b),setTimeout(()=>{L(!1)},500),F.current?F.current.show():console.error("Modal instance is not initialized.")},q=()=>{F.current?F.current.hide():console.error("Modal instance is not initialized.")},xe=a=>{H==="admin"?j(a):ee(a),setTimeout(()=>{L(!1)},500),M.current?M.current.show():console.error("Modal instance is not initialized.")},Y=()=>{M.current?M.current.hide():console.error("Modal instance is not initialized.")};return window.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container main",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-9 mt-3 mb-5",children:[e.jsx(K,{state:E,productList:_,tempProduct:o,openProductModal:ge,openDeleteModal:xe,handleChangeOption:re,setTempProduct:j,setTempImgUrl:d,setState:L}),e.jsx(pe,{pageInfo:k,handlePageChange:se})]}),e.jsx("div",{className:"col-md-3 mt-4 mb-5",children:e.jsx(Q,{tempProduct:o,tempImgUrl:x,setTempImgUrl:d})})]})})}),e.jsx(X,{productModalRef:W,target:A,tempProduct:o,categories:I,units:O,handleInputChange:te,handleFileChange:me,handleImageChange:ie,imagesUrlRemove:de,badgeReplace:ne,imagesUrlAdd:oe,closeProductModal:q,handleModalUpdate:ce}),e.jsx(fe,{deleteModalRef:z,tempProduct:o,navigation:H,cartItem:P,deleteProduct:le,closeDeleteModal:Y})]})}export{we as default};
