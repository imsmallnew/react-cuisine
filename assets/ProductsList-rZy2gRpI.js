import{a as S,r as a,b as R,s as A,e as w,p as m,h as H,j as t,c as v,f as I,g as L}from"./index-DSFv4uQF.js";import{h as r,A as D}from"./proxy-B1fbcxKK.js";function U(){const x="https://ec-course-api.hexschool.io",p="imsmallnew",i=S(),[n,N]=a.useState({}),[u,g]=a.useState(!1),[o,k]=a.useState(null),[C]=a.useState("menu"),[l,c]=a.useState(null),f=R(),h=l?o==null?void 0:o.filter(e=>e.category===l):o;a.useEffect(()=>{const s=new URLSearchParams(f.search).get("category");s&&c(s)},[f.search,c]);const b=a.useCallback(async()=>{i(A("讀取中..."));try{let s=(await w.get(`${x}/v2/api/${p}/products/all`)).data.products;k(s)}catch(e){console.error(e),i(m({title:"取得商品列表失敗",text:e==null?void 0:e.message,status:"failed"}))}finally{i(H())}},[x,p,i]);a.useEffect(()=>{b()},[C,b]);const $=async(e,s)=>{var j,y;N(e),g(!0);try{await w.post(`${x}/v2/api/${p}/cart`,{data:{product_id:e.id,qty:Number(s)}}),i(L(!1)),i(m({title:"更新數量成功",text:`[${e.title}] 已加入購物車 ${s} ${e.unit}`,status:"success"})),g(!1)}catch(d){i(m({title:"更新數量失敗",text:((y=(j=d==null?void 0:d.response)==null?void 0:j.data)==null?void 0:y.message)||`[${e.title}] 加到購物車失敗`,status:"failed"})),console.error(d)}};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"container-fluid",style:{backgroundImage:"url('https://images.unsplash.com/photo-1491960693564-421771d727d6?q=80&w=2863&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D')",backgroundSize:"cover",backgroundPosition:"center",minHeight:"100vh",position:"relative",paddingTop:"70px"},children:[t.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.2)",zIndex:1}}),t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"d-flex flex-md-column flex-row col-12 col-md-2 d-md-block category-list",children:t.jsxs("ul",{className:"list-group list-group-horizontal-md list-group-flush flex-md-column flex-row w-100 text-center",children:[t.jsx(r.li,{className:`list-group-item ${l===null?"active bg-warning text-dark":""}`,onClick:()=>c(null),style:{cursor:"pointer",backgroundColor:"transparent",color:"#fff",border:"none"},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:"全部商品"}),[...new Set(o==null?void 0:o.map(e=>e.category))].map((e,s)=>t.jsx(r.li,{className:`list-group-item ${l===e?"active bg-warning text-dark":""}`,onClick:()=>c(e),style:{cursor:"pointer",backgroundColor:"transparent",color:"#fff",border:"none"},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.1,duration:.5},children:e},e))]})}),t.jsx("div",{className:"col-12 col-md-10 offset-md-2 ps-4 pe-4 mt-md-0 mt-5 pt-3",style:{zIndex:10},children:t.jsx(D,{mode:"wait",children:t.jsx(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.5},className:"row mt-4",children:h==null?void 0:h.map(e=>t.jsx("div",{className:"col-12 col-sm-6 col-md-6 col-lg-4 col-xl-3 mb-3",children:t.jsxs(r.div,{className:"card h-100",whileHover:{scale:1.02},transition:{duration:.3},style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",boxShadow:"0 4px 10px rgba(0,0,0,0.3)",borderRadius:"10px",overflow:"hidden",padding:"10px",paddingBottom:"5px"},children:[t.jsx(v,{to:`/products/${e.id}`,children:t.jsx("div",{className:"overflow-hidden",style:{height:"250px",borderRadius:"10px",position:"relative"},children:t.jsx(r.img,{src:e==null?void 0:e.imageUrl,alt:"商品圖片",className:"card-img-top",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"10px",position:"absolute",top:"0",left:"0",transformOrigin:"center"},whileHover:{scale:1.05},transition:{duration:.3}})})}),t.jsxs("div",{className:"card-body text-center text-white",children:[t.jsx("h4",{className:"card-title",children:e.title}),t.jsx("span",{className:"badge bg-danger me-1 mt-1",style:{verticalAlign:"top"},children:e.category}),t.jsxs("h4",{className:"text-warning d-inline",children:[" ",e.price," 元 "]}),t.jsx("h6",{className:"text-light d-inline",children:t.jsxs("del",{children:[e.origin_price," 元"]})})]}),t.jsxs("div",{className:"card-footer d-flex",children:[t.jsxs(v,{className:"btn btn-outline-light w-50 d-flex justify-content-center align-items-center",to:`/products/${e.id}`,children:[t.jsx("i",{className:"fas fa-search me-2"})," 商品詳情"]}),t.jsxs("button",{type:"button",className:"btn btn-outline-warning w-50 d-flex justify-content-center align-items-center ms-2",onClick:()=>$(e,1),disabled:n&&u&&e.id===n.id,children:[t.jsx("div",{className:"d-flex align-items-center",children:n&&u&&e.id===n.id?t.jsx(I,{type:"spin",color:"#FFD700",height:"1rem",width:"1rem",className:"d-flex"}):t.jsx("i",{className:"fa-solid fa-cart-shopping"})}),t.jsx("span",{className:"ms-2",children:"加入購物車"})]})]})]})},e.id))},l)})})]})]})})}export{U as default};
