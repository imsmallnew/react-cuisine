import{i as L,d as E,a as F,r as i,s as C,e as j,h as b,j as e,g as R,p as k}from"./index-DSFv4uQF.js";import{h as n,A as _}from"./proxy-B1fbcxKK.js";function W(){var P;const o="https://ec-course-api.hexschool.io",d="imsmallnew",{id:l}=L(),u=E(),c=F(),[a,$]=i.useState({}),[f,p]=i.useState(null),[r,H]=i.useState([]),[v,S]=i.useState(null),[N,U]=i.useState(null),[w,g]=i.useState(1),y=i.useCallback(async()=>{c(C("讀取中..."));try{let s=(await j.get(`${o}/v2/api/${d}/products/all`)).data.products;H(s)}catch(t){console.error(t)}finally{c(b())}},[o,d,c]),I=i.useCallback(async()=>{try{let s=(await j.get(`${o}/v2/api/${d}/product/${l}`)).data.product;$(s),p(s.imageUrl),g(1)}catch(t){console.error(t)}finally{c(b())}},[o,d,l,c]);i.useEffect(()=>{if(r.length===0)return;const t=r.findIndex(x=>x.id===l),s=t>0?r[t-1].id:null,m=t<r.length-1?r[t+1].id:null;S(s),U(m)},[r,l]),i.useEffect(()=>{y()},[y]),i.useEffect(()=>{I()},[l,I]);const A=async(t,s)=>{var m,x;c(C("加入購物車中..."));try{await j.post(`${o}/v2/api/${d}/cart`,{data:{product_id:t.id,qty:Number(s)}}),c(R()),c(k({title:"更新數量成功",text:`[${t.title}] 已加入購物車 ${s} ${t.unit}`,status:"success"})),g(1)}catch(h){console.error(h),c(k({title:"更新數量失敗",text:((x=(m=h==null?void 0:h.response)==null?void 0:m.data)==null?void 0:x.message)||`[${t.title}] 加到購物車失敗`,status:"failed"}))}finally{c(b())}},D=async t=>{g(Number(t.target.value))};return e.jsxs("div",{className:"container-fluid",style:{backgroundImage:"url('https://images.unsplash.com/photo-1491960693564-421771d727d6?q=80&w=2863&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D')",backgroundSize:"cover",backgroundPosition:"center",minHeight:"100vh",paddingTop:"60px",paddingBottom:"10px",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1}}),e.jsxs("div",{className:"row position-relative m-2",style:{zIndex:2},children:[e.jsx("div",{className:"col-1 d-flex align-items-center justify-content-center",children:v&&e.jsx(n.button,{className:"arrow-btn3 left",onClick:()=>u(`/products/${v}`),whileHover:{scale:1.2,boxShadow:"0px 0px 15px rgba(255, 215, 0, 0.8)"},whileTap:{scale:.9},transition:{duration:.2},children:"❮"})}),e.jsx("div",{className:"col-md-10 col-12",children:e.jsx(_,{mode:"wait",children:e.jsx(n.div,{className:"card shadow-lg p-4",initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.5},style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 4px 10px rgba(0,0,0,0.3)"},children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-4",children:e.jsx("div",{className:"mainWrap overflow-hidden position-relative ms-lg-3",style:{borderRadius:"12px",height:"100%"},children:e.jsx(n.img,{src:f,className:"object-fit-cover img-fluid w-100 h-100 rounded",alt:"主圖",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",transformOrigin:"center"},whileHover:{scale:1.05},transition:{duration:.3}})})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"card-body text-white px-md-3 px-0",children:[e.jsx("h2",{className:"card-title",children:a.title}),e.jsx("h5",{children:e.jsx("span",{className:"badge bg-danger",children:a.category})}),e.jsxs("p",{className:"card-text",children:["商品描述: ",e.jsx("small",{className:"text-light",children:a.description})]}),e.jsxs("p",{className:"card-text",children:["商品內容: ",e.jsx("small",{className:"text-light",children:a.content})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("h4",{className:"card-text text-warning fw-bold",children:[a.price," 元"]}),e.jsx("h5",{className:"text-light mx-2",children:e.jsxs("del",{children:[a.origin_price," 元"]})})]}),e.jsxs("div",{className:"d-flex align-items-center my-3",children:[e.jsx("label",{htmlFor:"price",className:"form-label me-2",children:"訂購數量:"}),e.jsx("select",{className:"form-select w-auto",value:w,onChange:t=>D(t),children:Array.from({length:10}).map((t,s)=>e.jsx("option",{value:s+1,children:s+1},s))})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx("button",{type:"button",className:"btn btn-outline-light w-50 d-flex justify-content-center align-items-center",onClick:()=>u("/products"),children:"返回商品列表"}),e.jsx("button",{type:"button",className:"btn btn-outline-warning w-50 d-flex justify-content-center align-items-center ms-2",onClick:()=>A(a,w),children:"加入購物車"})]})]})}),f?e.jsxs("div",{className:"col-md-12 mt-3",children:[e.jsx("p",{className:"ps-3 text-white",children:"更多圖片 (點圖放大):"}),e.jsxs("div",{className:"row ps-3 pe-3",children:[a.imageUrl&&e.jsx(n.div,{className:"col-md-2 mb-3",whileHover:{scale:1.1},transition:{duration:.3},children:e.jsx("div",{className:"subWrap",children:e.jsx("div",{className:"imgFrame",children:e.jsx("img",{src:a.imageUrl,className:"card-img w-100 h-100 object-fit-cover rounded",alt:"副圖",onClick:()=>p(a.imageUrl)})})})}),(P=a==null?void 0:a.imagesUrl)==null?void 0:P.map((t,s)=>t&&e.jsx(n.div,{className:"col-md-2 mb-3",whileHover:{scale:1.1},transition:{duration:.3},children:e.jsx("div",{className:"subWrap",children:e.jsx("div",{className:"imgFrame",children:e.jsx("img",{src:t,className:"card-img w-100 h-100 object-fit-cover rounded",alt:"副圖",onClick:()=>p(t)})})})},s))]})]}):e.jsxs("h6",{className:"text-danger",children:[e.jsx("i",{className:"fa-regular fa-image"})," 主圖 尚未提供連結"]})]})},l)})}),e.jsx("div",{className:"col-1 d-flex align-items-center justify-content-center",children:N&&e.jsx(n.button,{className:"arrow-btn3 right",onClick:()=>u(`/products/${N}`),whileHover:{scale:1.2,boxShadow:"0px 0px 15px rgba(255, 215, 0, 0.8)"},whileTap:{scale:.9},transition:{duration:.2},children:"❯"})})]})]})}export{W as default};
