import{d as v,a as b,j as a,s as f,e as h,p as g,h as j,P as w,u as A,b as P,r as c,L as x,c as O,N as E,O as R}from"./index-CZ8Xrph2.js";import{T as S}from"./Toast-Cwk6zxGf.js";import{S as C}from"./ScrollToTop-CWrUMBBf.js";import{l as W}from"./logo-8gluHM_i.js";import"./bootstrap.esm-CPbp9n-C.js";function N({menuOpen:r}){const d="https://ec-course-api.hexschool.io",m=v(),t=b(),o=async()=>{var i,e;t(f("讀取中..."));try{await h.post(`${d}/v2/logout`),document.cookie="reactHWToken=; expires=",t(g({title:"系統提示",text:"使用者已登出",status:"success"})),m("/login")}catch(n){console.error(n),t(g({title:"系統提示",text:((e=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:e.message)||"使用者登出失敗",status:"failed"}))}finally{t(j())}};return a.jsx(a.Fragment,{children:a.jsx("div",{className:"nav-item",children:a.jsx("button",{className:`btn ${r?"btn-lg":"btn-sm"} btn-outline-secondary`,type:"button",id:"logoutBtn",onClick:o,children:"登出後台"})})})}N.propTypes={menuOpen:w.bool.isRequired};function F(){const r="https://ec-course-api.hexschool.io",{isLoading:d,loadingText:m}=A(s=>s.loading),t=P(),o=v(),i=b(),[e,n]=c.useState(!1),[L,p]=c.useState(null),k=t.pathname.startsWith("/admin/products/"),y=t.pathname.startsWith("/admin/orders/"),T=[{path:"/admin",name:"後台首頁",navName:"admin"},{path:"/admin/products/1",name:"商品管理",navName:"products"},{path:"/admin/orders/1",name:"訂單管理",navName:"orders"},{path:"/",name:"返回前台",navName:"front"}],u=c.useCallback(async(s=0)=>{i(f("讀取中..."));try{await h.post(`${r}/v2/api/user/check`),p(!0)}catch(l){console.error(l),s<3?setTimeout(()=>u(s+1),500):(p(!1),o("/login"))}finally{i(j())}},[r,i,o]);return c.useEffect(()=>{const s=document.cookie.replace(/(?:(?:^|.*;\s*)reactHWToken\s*=\s*([^;]*).*$)|^.*$/,"$1");s.length>0?(h.defaults.headers.common.Authorization=s,u()):(p(!1),o("/login"))},[u,o]),c.useEffect(()=>{window.scrollTo({top:0,behavior:"auto"})},[t.pathname]),L===null?a.jsx(x,{loadingText:"登入驗證中..."}):a.jsxs(a.Fragment,{children:[d&&a.jsx(x,{loadingText:m}),a.jsx(S,{}),a.jsx("nav",{className:"navbar navbar-light navbar-expand-lg text-primary fixed-top shadow bg-dark","data-bs-theme":"dark",children:a.jsxs("div",{className:"container",children:[a.jsxs(O,{className:"navbar-brand site-title",to:"/admin",children:[a.jsx("img",{src:W,style:{width:50,marginRight:"5px"},alt:"Logo"})," Daniel's Burger Admin"]}),a.jsx("button",{className:"navbar-toggler",type:"button",onClick:()=>n(!e),children:a.jsx("span",{className:"navbar-toggler-icon"})}),a.jsx("div",{className:`collapse navbar-collapse ${e?"show":""}`,children:a.jsxs("ul",{className:"navbar-nav ms-auto",children:[T.map((s,l)=>{const $=t.pathname===s.path;return a.jsx("li",{className:"nav-item",children:a.jsx(E,{to:s.path,onClick:()=>n(!1),className:()=>`btn ${e?"btn-lg":"btn-sm"} ${s.navName==="products"&&k||s.navName==="orders"&&y||$?"btn-secondary":"btn-outline-secondary"} ms-2`,children:s.name},l)},l)}),a.jsx("li",{className:"nav-item ms-2 logout",children:a.jsx(N,{menuOpen:e})})]})})]})}),a.jsx(R,{}),a.jsx(C,{})]})}export{F as default};
