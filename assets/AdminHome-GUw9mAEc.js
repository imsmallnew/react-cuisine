import{a as k,r,e as y,p as E,h as $,j as e,f as u}from"./index-CZ8Xrph2.js";function L(){const x="https://ec-course-api.hexschool.io",m="imsmallnew",h=k(),[d,N]=r.useState(!0),[v,w]=r.useState([]),[b,S]=r.useState([]),[A,O]=r.useState(0),[R,B]=r.useState([]),f=r.useCallback(a=>{const t={};let c=0;a.forEach(l=>{c+=l.total||0,Object.values(l.products).forEach(s=>{var g;const o=((g=s.product)==null?void 0:g.title)||"未知商品",D=(s==null?void 0:s.qty)||0,T=(s==null?void 0:s.final_total)||0;t[o]||(t[o]={totalNum:0,totalAmount:0}),t[o].totalNum+=D,t[o].totalAmount+=T})});const i=Object.entries(t).sort((l,s)=>s[1].totalNum-l[1].totalNum).slice(0,3).map(([l,s])=>({title:l,...s})),n=Object.entries(t).sort((l,s)=>s[1].totalAmount-l[1].totalAmount).slice(0,3).map(([l,s])=>({title:l,...s}));w(i),S(n),O(c),N(!1)},[]),p=r.useCallback(a=>{const t=new Date().toISOString().split("T")[0];let c=0,i=0,n=0;a.forEach(s=>{new Date(s.create_at*1e3).toISOString().split("T")[0]===t&&(c+=1),s.is_paid?i+=1:n+=1});const l=[{title:"📅 今日訂單:",value:c+" 件"},{title:"📦 總訂單:",value:a.length+" 件"},{title:"✅ 已付款:",value:i+" 件"},{title:"❌ 未付款:",value:n+" 件"}];B(l)},[]),j=r.useCallback(async()=>{var a,t;try{const c=await y.get(`${x}/v2/api/${m}/admin/orders`),{total_pages:i}=c.data.pagination;let n=c.data.orders;const l=[];for(let o=2;o<=i;o++)l.push(y.get(`${x}/v2/api/${m}/admin/orders?page=${o}`));(await Promise.all(l)).forEach(o=>{n=n.concat(o.data.orders)}),f(n),p(n)}catch(c){console.error(c),h(E({title:"獲取訂單失敗",text:((t=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:t.message)||"請稍後再試",status:"failed"}))}finally{h($())}},[x,m,p,f,h]);return r.useEffect(()=>{j()},[j]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"position-fixed w-100",style:{minHeight:"100vh",backgroundImage:"url('https://images.unsplash.com/photo-1491960693564-421771d727d6?q=80&w=1024&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",overflow:"auto"}}),e.jsxs("div",{className:"container mt-5 pt-2",children:[e.jsx("div",{className:"main text-white mb-5 text-center",children:e.jsx("h1",{className:"text-center pb-2 fs-1 fw-bold",children:"歡迎來到商品管理後台！"})}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card p-3 shadow h-100 d-flex flex-column card-bg",children:[e.jsx("h4",{children:"💰 訂單總收入"}),e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:d?e.jsx(u,{type:"spin",color:"#000000",height:"2rem",width:"2rem",className:"d-flex text-success"}):e.jsxs("p",{className:"display-3 text-success text-center logo-type",children:["$",A.toLocaleString()]})})]})}),e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card p-3 shadow h-100 d-flex flex-column card-bg",children:[e.jsx("h4",{children:"📊 訂單狀態"}),d?e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsx(u,{type:"spin",color:"#000000",height:"2rem",width:"2rem",className:"d-flex text-success"})}):e.jsx("ul",{className:"flex-grow-1 d-flex flex-column justify-content-center",children:R.map((a,t)=>e.jsxs("li",{children:[a.title," ",a.value]},t))})]})}),e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card p-3 shadow d-flex flex-column card-bg",children:[e.jsx("h4",{className:"logo-type",children:"🔥 銷售數量 Top 3"}),d?e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsx(u,{type:"spin",color:"#000000",height:"2rem",width:"2rem",className:"d-flex text-success"})}):e.jsx("ul",{className:"flex-grow-1 d-flex flex-column justify-content-center",children:v.map((a,t)=>e.jsxs("li",{children:[t+1,". ",a.title," - ",a.totalNum," 件"]},t))})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card p-3 shadow  d-flex flex-column card-bg",children:[e.jsx("h4",{className:"logo-type",children:"💵 銷售金額 Top 3"}),d?e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsx(u,{type:"spin",color:"#000000",height:"2rem",width:"2rem",className:"d-flex text-success"})}):e.jsx("ul",{className:"flex-grow-1 d-flex flex-column justify-content-center",children:b.map((a,t)=>e.jsxs("li",{children:[t+1,". ",a.title," - $",a.totalAmount.toLocaleString()]},t))})]})})]})]})]})}export{L as default};
