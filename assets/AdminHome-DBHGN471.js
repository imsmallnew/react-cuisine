import{d as E,a as H,r as n,e as h,p as C,h as N,s as _,j as e,f}from"./index-DSFv4uQF.js";function M(){const u="https://ec-course-api.hexschool.io",p="imsmallnew",x=E(),i=H(),[m,b]=n.useState(!0),[S,A]=n.useState([]),[k,O]=n.useState([]),[$,R]=n.useState(0),[T,B]=n.useState([]),g=n.useCallback(t=>{const s={};let l=0;t.forEach(c=>{l+=c.total||0,Object.values(c.products).forEach(a=>{var y;const o=((y=a.product)==null?void 0:y.title)||"未知商品",D=(a==null?void 0:a.qty)||0,L=(a==null?void 0:a.final_total)||0;s[o]||(s[o]={totalNum:0,totalAmount:0}),s[o].totalNum+=D,s[o].totalAmount+=L})});const d=Object.entries(s).sort((c,a)=>a[1].totalNum-c[1].totalNum).slice(0,3).map(([c,a])=>({title:c,...a})),r=Object.entries(s).sort((c,a)=>a[1].totalAmount-c[1].totalAmount).slice(0,3).map(([c,a])=>({title:c,...a}));A(d),O(r),R(l),b(!1)},[]),j=n.useCallback(t=>{const s=new Date().toISOString().split("T")[0];let l=0,d=0,r=0;t.forEach(a=>{new Date(a.create_at*1e3).toISOString().split("T")[0]===s&&(l+=1),a.is_paid?d+=1:r+=1});const c=[{title:"📅 今日訂單:",value:l+" 件"},{title:"📦 總訂單:",value:t.length+" 件"},{title:"✅ 已付款:",value:d+" 件"},{title:"❌ 未付款:",value:r+" 件"}];B(c)},[]),v=n.useCallback(async()=>{var t,s;try{const l=await h.get(`${u}/v2/api/${p}/admin/orders`),{total_pages:d}=l.data.pagination;let r=l.data.orders;const c=[];for(let o=2;o<=d;o++)c.push(h.get(`${u}/v2/api/${p}/admin/orders?page=${o}`));(await Promise.all(c)).forEach(o=>{r=r.concat(o.data.orders)}),g(r),j(r)}catch(l){console.error(l),i(C({title:"獲取訂單失敗",text:((s=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:s.message)||"請稍後再試",status:"failed"}))}finally{i(N())}},[u,p,j,g,i]),w=n.useCallback(async()=>{var t,s;i(_("讀取中..."));try{await h.post(`${u}/v2/api/user/check`),v()}catch(l){alert((s=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:s.message),x("/login")}},[u,v,i,x]);return n.useEffect(()=>{const t=document.cookie.replace(/(?:(?:^|.*;\s*)reactHWToken\s*=\s*([^;]*).*$)|^.*$/,"$1");t.length>0?(h.defaults.headers.common.Authorization=t,w()):(i(N()),x("/login"))},[w,i,x]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"position-fixed w-100",style:{minHeight:"100vh",backgroundImage:"url('https://images.unsplash.com/photo-1491960693564-421771d727d6?q=80&w=1024&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",overflow:"auto"}}),e.jsxs("div",{className:"container mt-5 pt-2",children:[e.jsx("div",{className:"main text-white mb-5 text-center",children:e.jsx("h1",{children:"歡迎來到商品管理後台！"})}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card p-3 shadow h-100 d-flex flex-column card-bg",children:[e.jsx("h4",{children:"💰 訂單總收入"}),e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:m?e.jsx(f,{type:"spin",color:"#000000",height:"2rem",width:"2rem",className:"d-flex text-success"}):e.jsxs("p",{className:"fs-1 text-success text-center",children:["$",$.toLocaleString()]})})]})}),e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card p-3 shadow h-100 d-flex flex-column card-bg",children:[e.jsx("h4",{children:"📊 訂單狀態"}),m?e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsx(f,{type:"spin",color:"#000000",height:"2rem",width:"2rem",className:"d-flex text-success"})}):e.jsx("ul",{className:"flex-grow-1 d-flex flex-column justify-content-center",children:T.map((t,s)=>e.jsxs("li",{children:[t.title," ",t.value]},s))})]})}),e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card p-3 shadow d-flex flex-column card-bg",children:[e.jsx("h4",{children:"🔥 銷售數量 Top 3"}),m?e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsx(f,{type:"spin",color:"#000000",height:"2rem",width:"2rem",className:"d-flex text-success"})}):e.jsx("ul",{className:"flex-grow-1 d-flex flex-column justify-content-center",children:S.map((t,s)=>e.jsxs("li",{children:[s+1,". ",t.title," - ",t.totalNum," 件"]},s))})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card p-3 shadow  d-flex flex-column card-bg",children:[e.jsx("h4",{children:"💵 銷售金額 Top 3"}),m?e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsx(f,{type:"spin",color:"#000000",height:"2rem",width:"2rem",className:"d-flex text-success"})}):e.jsx("ul",{className:"flex-grow-1 d-flex flex-column justify-content-center",children:k.map((t,s)=>e.jsxs("li",{children:[s+1,". ",t.title," - $",t.totalAmount.toLocaleString()]},s))})]})})]})]})]})}export{M as default};
