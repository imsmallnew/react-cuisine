import{a as T,u as B,r as a,j as e,e as j,s as f,d as g,g as y,p as c,h as N}from"./index-BHl6oezR.js";import{M as G}from"./bootstrap.esm-CPbp9n-C.js";import{D as V}from"./DeleteModal-BmoaQwfJ.js";function Y(){var M,$,C,m;const h="https://ec-course-api.hexschool.io",u="imsmallnew",l=T(),{cartList:n}=B(s=>s.cart),R={title:"",category:"",unit:"",origin_price:"",price:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[]},[H]=a.useState(R),[z,A]=a.useState({}),[w]=a.useState(!1),[U]=a.useState("cart"),p=a.useRef(null),x=a.useRef(null);a.useEffect(()=>{p.current&&(x.current=new G(p.current,{backdrop:!1}))},[]);const v=s=>{A(s),x.current?x.current.show():console.error("Modal instance is not initialized.")},b=()=>{x.current?x.current.hide():console.error("Modal instance is not initialized.")};window.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()});const k=async(s,d)=>{var t,o,i,D,S,q,E;l(f("更新購物車中..."));try{const r=await g.put(`${h}/v2/api/${u}/cart/${s==null?void 0:s.id}`,{data:{product_id:(t=s==null?void 0:s.product)==null?void 0:t.id,qty:Number(d)}});l(y()),l(c({title:"更新成功",text:`[${(o=s==null?void 0:s.product)==null?void 0:o.title}] 數量已更新為 ${(D=(i=r.data)==null?void 0:i.data)==null?void 0:D.qty} ${(S=s==null?void 0:s.product)==null?void 0:S.unit}`,status:"success"}))}catch(r){console.error(r),l(c({title:"系統提示",text:((E=(q=r==null?void 0:r.response)==null?void 0:q.data)==null?void 0:E.message)||"購物車更新數量失敗",status:"failed"}))}finally{l(N())}},_=async s=>{var d,t,o;l(f("移除購物車商品中..."));try{await g.delete(`${h}/v2/api/${u}/cart/${s.id}`),b(),l(y()),l(c({title:"刪除成功",text:`[${(d=s==null?void 0:s.product)==null?void 0:d.title}] 已從購物車移除`,status:"success"}))}catch(i){console.error(i),l(c({title:"系統提示",text:((o=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:o.message)||"刪除購物車商品失敗",status:"failed"}))}finally{l(N())}},P=async()=>{var s,d;l(f("清空購物車商品中..."));try{await g.delete(`${h}/v2/api/${u}/carts`),b(),l(y()),l(c({title:"系統提示",text:"購物車已清空",status:"success"}))}catch(t){console.error(t),l(c({title:"系統提示",text:((d=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:d.message)||"清空購物車商品失敗",status:"failed"}))}finally{l(N())}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container-fluid",style:{backgroundImage:"url('https://images.unsplash.com/photo-1491960693564-421771d727d6?q=80&w=2863&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D')",backgroundSize:"cover",backgroundPosition:"center",minHeight:"100vh",paddingTop:"60px",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.3)",zIndex:1}}),e.jsx("div",{className:"container position-relative pb-5",style:{zIndex:2},children:e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"table-responsive",children:[((M=n==null?void 0:n.carts)==null?void 0:M.length)===0&&e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"badge bg-warning p-2 pe-3 ps-3 text-dark fs-6 mt-2 lh-base",children:["[溫馨提示]: 購物車目前為空！",e.jsx("br",{className:"mobileValue"}),"請至 ",e.jsx(j,{className:"text-danger text-decoration-none",to:"/products",children:"商品列表"})," 挑選你想吃的唷 ( *´ސު｀*)"]})}),e.jsxs("table",{className:"table mt-3 table-hover text-dark bg-light rounded-3 overflow-hidden shadow-sm",children:[e.jsx("thead",{className:"table-warning text-dark",children:e.jsxs("tr",{className:"text-center",children:[e.jsx("th",{style:{width:"120px"},children:"圖片"}),e.jsx("th",{children:"商品名稱"}),e.jsx("th",{children:"分類"}),e.jsx("th",{style:{width:"150px"},children:"訂購數量"}),e.jsx("th",{children:"單價"}),e.jsx("th",{children:"小計"}),e.jsx("th",{style:{width:"180px"}})]})}),e.jsx("tbody",{children:($=n==null?void 0:n.carts)==null?void 0:$.map(s=>{var d,t,o,i;return e.jsxs("tr",{className:"align-middle text-center",children:[e.jsx("td",{className:"text-start",children:e.jsx("img",{src:(d=s==null?void 0:s.product)==null?void 0:d.imageUrl,className:"rounded border border-gold",alt:"主圖",width:"100"})}),e.jsx("td",{className:"text-center",children:e.jsx("h5",{children:(t=s==null?void 0:s.product)==null?void 0:t.title})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-danger",children:(o=s==null?void 0:s.product)==null?void 0:o.category})}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{type:"button",disabled:(s==null?void 0:s.qty)===1||w,className:"btn btn-outline-dark btn-sm",onClick:()=>k(s,(s==null?void 0:s.qty)-1),children:"-"}),e.jsx("span",{className:"btn border border-secondary bg-white text-dark",style:{width:"50px",cursor:"auto"},children:s.qty}),e.jsx("button",{type:"button",disabled:w,className:"btn btn-outline-dark btn-sm",onClick:()=>k(s,(s==null?void 0:s.qty)+1),children:"+"})]})}),e.jsxs("td",{className:"text-dark fw-bold",children:[(i=s==null?void 0:s.product)==null?void 0:i.price," 元"]}),e.jsxs("td",{className:"text-dark fw-bold",children:[s==null?void 0:s.total," 元"]}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>v(s),children:e.jsx("i",{className:"fas fa-trash-alt"})})})]},s==null?void 0:s.id)})}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"6",className:"text-end fs-5",children:"總計"}),e.jsxs("td",{className:"text-end text-danger fs-4 fw-bold pe-5",children:[n==null?void 0:n.total," 元"]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"6",className:"text-end fs-5",children:"折扣價"}),e.jsxs("td",{className:"text-end text-success fs-4 fw-bold pe-5",children:[n==null?void 0:n.final_total," 元"]})]})]})]})]}),e.jsxs("div",{className:"text-end mt-2",children:[e.jsx(j,{className:"btn btn-dark me-2 px-4 py-2",to:"/products",children:"繼續購物"}),((C=n==null?void 0:n.carts)==null?void 0:C.length)!==0&&e.jsx("button",{className:"btn btn-danger me-2 px-4 py-2",type:"button",onClick:()=>v({}),children:"清空購物車"}),((m=n==null?void 0:n.carts)==null?void 0:m.length)!==0&&e.jsx(j,{className:"btn btn-dark px-4 py-2",to:"/form",children:"結帳表單"})]})]})})]}),e.jsx(V,{deleteModalRef:p,tempProduct:H,navigation:U,cartItem:z,removeCartItem:_,removeAllCart:P,closeDeleteModal:b})]})}export{Y as default};
